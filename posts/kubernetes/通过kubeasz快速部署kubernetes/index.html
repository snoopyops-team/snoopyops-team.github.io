<!DOCTYPE html>
<html lang="zh-CN"><head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
    <meta name="description" content="通过kubeasz快速部署Kubernetes - https://www.snoopyops.top/posts/kubernetes/%E9%80%9A%E8%BF%87kubeasz%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2kubernetes/">
    <meta name="author" content="snoopy - https://www.snoopyops.top/">
    
    <meta name="msvalidate.01" content="B46311949B856F2A7015F366FB3CE878" />
    <title>通过kubeasz快速部署Kubernetes</title>
    <link rel="icon" type="image/png" href="/favicon.ico">
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-webfont/1.7.0/style.min.css" />
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/lxgw-wenkai-screen-webfont/1.7.0/style.min.css" />
    
    <link rel="stylesheet" href="https://www.snoopyops.top/style.min.6bbccf0916939df698171c34d30f896276712c30bd56be0d7fd8023e1b00c3d9.css">
    
    <script type="text/javascript" src="/main.js" defer></script>
    
    
    <script>
        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?080713f769977324f1fbafc95c5fa4c6";
            var s = document.getElementsByTagName("script")[0]; 
            s.parentNode.insertBefore(hm, s);
        })();
    </script>
</head>
<body class="active-animate cool">
        <div class="cool-before" style="background: url('/imgs/bg/foxgirl.jpg') center center/cover no-repeat fixed;"></div>
        <div id="readmore-container">
            <div id="header" class=""><div class="container-header">
    
    
    <div class="right">
        
        <h1 class="title">通过kubeasz快速部署Kubernetes</h1>
    
        
            
            <div id="toc">📜</div>
        
    </div>
</div>
</div>
            <div id="content">










<div class="container-main container-page ">

    <div class="desc">
        
        <span>
            
            <svg t="1656736000388" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7409" width="12" height="12"><path d="M524.885333 338.986667L200.362667 663.466667c-17.28 15.274667-27.989333 36.693333-29.696 56.234666v133.76l130.730666 0.085334c22.784-1.621333 43.989333-12.245333 61.013334-31.701334l322.688-322.645333-160.213334-160.213333z m60.373334-60.330667l160.170666 160.213333 102.144-102.144a19.712 19.712 0 0 0 0-27.861333L715.093333 176.426667a19.456 19.456 0 0 0-27.605333 0L585.258667 278.613333zM701.312 85.333333c27.946667 0 54.741333 11.136 74.282667 30.848l132.309333 132.309334a105.045333 105.045333 0 0 1 0 148.565333L424.874667 879.957333c-29.824 34.346667-72.106667 55.466667-120.448 58.794667H85.333333v-42.666667l0.128-179.84c3.626667-44.970667 24.576-86.826667 56.448-114.944l485.12-485.034666A104.789333 104.789333 0 0 1 701.269333 85.333333z" p-id="7410" fill="#adb5bd"></path></svg>
            2023-12-06&nbsp;&nbsp;&nbsp;
            <svg t="1656737270708" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="23838" width="11" height="11"><path d="M824.264 95.36c0-23.859 25.043-44.16 48.902-44.16s49.714 20.301 49.714 44.16v190.08c0 23.859-19.054 52.868-42.913 52.868h-190.08c-23.859 0-46.696-25.96-46.696-49.819s22.55-46.249 46.409-46.249h82.025C702.344 175.534 610.22 155.853 512 155.853c-206.775 0-360.398 149.372-360.398 356.147 0 206.775 153.623 358.23 360.398 358.23 206.775 0 357.467-151.455 357.467-358.23 0-23.859 23.634-50.706 53.413-50.706 29.78 0 49.92 26.847 49.92 50.706 0 254.493-206.307 460.8-460.8 460.8-254.493 0-460.8-206.307-460.8-460.8C51.2 257.507 257.507 51.2 512 51.2c122.4 0 226.684 33.296 312.264 117.369 0.358 0.351 0.358-24.052 0-73.209z" p-id="23839" fill="#adb5bd"></path></svg>
            2023-12-18&nbsp;&nbsp;&nbsp;
        </span>
        <span>
            
            <svg t="1656737548689" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="33866" width="12" height="12"><path d="M832.038608 64.662657H192.030028C121.255125 64.662657 63.940169 121.98845 63.940169 192.694717v446.793671C63.940169 710.205493 121.255125 767.643272 192.030028 767.643272h133.353183a63.940169 63.940169 0 0 1 55.219742 31.576328l76.099638 129.83828c12.358154 21.093031 33.790754 31.626903 55.216129 31.626903s42.832688-10.544709 55.198067-31.619678l76.222461-129.870792a63.940169 63.940169 0 0 1 55.212517-31.551041h133.54103c70.576219 0 127.732228-57.289669 127.732227-127.800865V192.391272C959.825022 121.85479 902.643727 64.662657 832.038608 64.662657zM895.884854 639.842407A63.85347 63.85347 0 0 1 832.092795 703.703103h-133.54103a127.753903 127.753903 0 0 0-110.349172 63.09847l-76.222461 129.856342a0.274545 0.274545 0 0 1 0-0.050574h-0.032512s-0.021675 0.061411-0.032512 0.061412l-76.1466-129.85273A127.804477 127.804477 0 0 0 325.383211 703.703103H192.030028A64.207489 64.207489 0 0 1 127.880338 639.488388V192.694717A64.102729 64.102729 0 0 1 192.030028 128.602826h640.00858A63.799284 63.799284 0 0 1 895.884854 192.391272v447.451135z" fill="#adb5bd" p-id="33867"></path><path d="M608.154093 288.092004A31.970084 31.970084 0 0 0 576.184009 320.062089v160.078006l-134.650049-179.278119A31.970084 31.970084 0 0 0 384.002258 320.062089v255.760676a31.970084 31.970084 0 0 0 63.940169 0v-159.958796l134.650048 179.274507a31.970084 31.970084 0 0 0 57.531703-19.200113V320.062089a31.970084 31.970084 0 0 0-31.970085-31.970085z" fill="#adb5bd" p-id="33868"></path></svg>
            2189 字</span>&nbsp;
        <span>
            
            <svg t="1656737462334" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="32892" width="12" height="12"><path d="M512 74.666667C270.933333 74.666667 74.666667 270.933333 74.666667 512S270.933333 949.333333 512 949.333333 949.333333 753.066667 949.333333 512 753.066667 74.666667 512 74.666667z m0 810.666666c-204.8 0-373.333333-168.533333-373.333333-373.333333S307.2 138.666667 512 138.666667 885.333333 307.2 885.333333 512 716.8 885.333333 512 885.333333z" p-id="32893" fill="#adb5bd"></path><path d="M695.466667 567.466667l-151.466667-70.4V277.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v238.933334c0 12.8 6.4 23.466667 19.2 29.866666l170.666667 81.066667c4.266667 2.133333 8.533333 2.133333 12.8 2.133333 12.8 0 23.466667-6.4 29.866666-19.2 6.4-14.933333 0-34.133333-17.066666-42.666666z" p-id="32894" fill="#adb5bd"></path></svg>
            5 分钟</span>
            <div class="container-ctgtag">
	<div class="taxonomy">
		<div class="tag">
			
			
			<a href="/tags/kubernetes">Kubernetes</a>
			
		</div>
	</div>
</div>
        
    </div>
    
    <div class="toc">
        <div class="container-page-operation">
	<div class="page-operation">
		<div><a href="/"><img src="/imgs/icons/home-2.svg" alt=""></a></div>
		<div><a href="/nav"><img src="/imgs/icons/iov-navigate-1.svg" alt=""></a></div>
		<div><a href="/tags"><img src="/imgs/icons/treetags.svg" alt=""></a></div>
		<div id="light-dark"><a><img src="/imgs/icons/moon2.svg" alt=""></a></div>
		<div><a href="#"><img src="/imgs/icons/up2.svg" alt=""></a></div>
	</div>
</div>
        <nav id="TableOfContents">
  <ul>
    <li><a href="#环境">环境</a></li>
    <li><a href="#kubeasz安装">Kubeasz安装</a></li>
    <li><a href="#新建集群并修改配置文件">新建集群并修改配置文件</a></li>
    <li><a href="#安装集群">安装集群</a></li>
    <li><a href="#验证集群">验证集群</a></li>
    <li><a href="#添加节点">添加节点</a></li>
    <li><a href="#删除节点">删除节点</a></li>
  </ul>
</nav>
    </div>

    <div class='content  '>
        <p>在一些没有云环境的场景，比如自建机房中，当我们需要使用<code>Kubernetes</code>时，需要手动部署。如果通过二进制部署，部署过程相当繁琐。我们可以通过<code>kubeasz</code>工具实现<code>Kubernetes</code>的快速部署。</p>
<h2 id="环境">环境</h2>
<p>节点列表：</p>
<table>
<thead>
<tr>
<th>节点</th>
<th>IP</th>
<th>组件</th>
</tr>
</thead>
<tbody>
<tr>
<td>hw-sg-k8s-master-test-0001</td>
<td>192.168.1.56</td>
<td>etcd/master</td>
</tr>
<tr>
<td>hw-sg-k8s-master-test-0002</td>
<td>192.168.1.45</td>
<td>etcd/master</td>
</tr>
<tr>
<td>hw-sg-k8s-master-test-0003</td>
<td>192.168.1.117</td>
<td>etcd/master</td>
</tr>
<tr>
<td>hw-sg-k8s-node-test-0001</td>
<td>192.168.1.72</td>
<td>node</td>
</tr>
<tr>
<td>hw-sg-k8s-node-test-0002</td>
<td>192.168.1.7</td>
<td>node</td>
</tr>
</tbody>
</table>
<p>操作系统：<code>CentOS7.9</code></p>
<h2 id="kubeasz安装">Kubeasz安装</h2>
<p>使用<code>kubeasz</code>自动化部署程序安装。</p>
<p>以<code>hw-sg-k8s-master-test-0001</code>为管理机，生成密钥并与其他机器建立免密互信。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ssh-keygen
</span></span><span style="display:flex;"><span>ssh-copy-id 192.168.1.56
</span></span><span style="display:flex;"><span>ssh-copy-id 192.168.1.45
</span></span><span style="display:flex;"><span>ssh-copy-id 192.168.1.117
</span></span><span style="display:flex;"><span>ssh-copy-id 192.168.1.72
</span></span><span style="display:flex;"><span>ssh-copy-id 192.168.1.7
</span></span></code></pre></td></tr></table>
</div>
</div><p>确定<code>kubeasz</code>版本，这与最后选择的k8s版本密切相关。我这里需要部署的<code>Kubernetes</code> 版本是<code>1.24</code>，所以选择的<code>kubeasz</code>版本是<code>3.6.2</code>。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#0086b3">cd</span> /usr/local/src/
</span></span><span style="display:flex;"><span><span style="color:#0086b3">export</span> <span style="color:#008080">release</span><span style="color:#000;font-weight:bold">=</span>3.6.2
</span></span><span style="display:flex;"><span>wget https://github.com/easzlab/kubeasz/releases/download/<span style="color:#d14">${</span><span style="color:#008080">release</span><span style="color:#d14">}</span>/ezdown
</span></span><span style="display:flex;"><span>chmod a+x ezdown
</span></span><span style="display:flex;"><span>mv ezdown /usr/local/bin/
</span></span></code></pre></td></tr></table>
</div>
</div><p>下载<code>kubeasz</code>代码、二进制、默认容器镜像。此步骤可能需要较长时间，请耐心等待。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 国内环境</span>
</span></span><span style="display:flex;"><span>ezdown -D
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 海外环境</span>
</span></span><span style="display:flex;"><span>ezdown -D -m standard
</span></span></code></pre></td></tr></table>
</div>
</div><p>上述脚本运行成功后，所有文件（kubeasz代码、二进制、离线镜像）均已整理好放入目录<code>/etc/kubeasz</code>。</p>
<p><code>/etc/kubeasz</code> 包含<code>kubeasz</code>版本为<code>${release}</code>的发布代码。</p>
<p><code>/etc/kubeasz/bin</code> 包含<code>k8s/etcd/docker/cni</code>等二进制文件。</p>
<p><code>/etc/kubeasz/down</code> 包含集群安装时需要的离线容器镜像。</p>
<p>下载额外容器镜像（<code>cilium</code>,<code>flannel</code>,<code>prometheus</code>等）。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ezdown -X flannel
</span></span></code></pre></td></tr></table>
</div>
</div><p>容器化运行<code>kubeasz</code>。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ezdown -S
</span></span></code></pre></td></tr></table>
</div>
</div><p>验证容器是否创建成功。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker ps
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>CONTAINER ID   IMAGE                   COMMAND                   CREATED          STATUS          PORTS     NAMES
</span></span><span style="display:flex;"><span>68233de430bf   easzlab/kubeasz:3.6.2   <span style="color:#d14">&#34;tail -f /dev/null&#34;</span>       <span style="color:#099">14</span> minutes ago   Up <span style="color:#099">14</span> minutes             kubeasz
</span></span><span style="display:flex;"><span>d40a0bd15b11   registry:2              <span style="color:#d14">&#34;/entrypoint.sh /etc…&#34;</span>   <span style="color:#099">37</span> minutes ago   Up <span style="color:#099">37</span> minutes             local_registry
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="新建集群并修改配置文件">新建集群并修改配置文件</h2>
<p>创建新集群 <code>k8s-test</code>。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker <span style="color:#0086b3">exec</span> -it kubeasz ezctl new k8s-test
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2023-12-05 16:04:59 DEBUG generate custom cluster files in /etc/kubeasz/clusters/k8s-test
</span></span><span style="display:flex;"><span>2023-12-05 16:04:59 DEBUG <span style="color:#0086b3">set</span> versions
</span></span><span style="display:flex;"><span>2023-12-05 16:04:59 DEBUG disable registry mirrors
</span></span><span style="display:flex;"><span>2023-12-05 16:04:59 DEBUG cluster k8s-test: files successfully created.
</span></span><span style="display:flex;"><span>2023-12-05 16:04:59 INFO next steps 1: to config <span style="color:#d14">&#39;/etc/kubeasz/clusters/k8s-test/hosts&#39;</span>
</span></span><span style="display:flex;"><span>2023-12-05 16:04:59 INFO next steps 2: to config <span style="color:#d14">&#39;/etc/kubeasz/clusters/k8s-test/config.yml&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>根据提示配置<code>/etc/kubeasz/clusters/k8s-test/hosts</code>和<code>/etc/kubeasz/clusters/k8s-test/config.yml</code>文件。由于将宿主机的<code>/etc/kubeasz</code>目录挂载到了容器的<code>/etc/kubeasz</code>目录，所以直接修改宿主机上的文件即可。容器目录挂载关系如下：</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker inspect 68233de430bf | grep Mounts -A <span style="color:#099">33</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#d14">&#34;Mounts&#34;</span>: <span style="color:#000;font-weight:bold">[</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Type&#34;</span>: <span style="color:#d14">&#34;bind&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Source&#34;</span>: <span style="color:#d14">&#34;/root/.ssh&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Destination&#34;</span>: <span style="color:#d14">&#34;/root/.ssh&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Mode&#34;</span>: <span style="color:#d14">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;RW&#34;</span>: true,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Propagation&#34;</span>: <span style="color:#d14">&#34;rprivate&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Type&#34;</span>: <span style="color:#d14">&#34;bind&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Source&#34;</span>: <span style="color:#d14">&#34;/etc/docker&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Destination&#34;</span>: <span style="color:#d14">&#34;/etc/docker&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Mode&#34;</span>: <span style="color:#d14">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;RW&#34;</span>: true,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Propagation&#34;</span>: <span style="color:#d14">&#34;rprivate&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Type&#34;</span>: <span style="color:#d14">&#34;bind&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Source&#34;</span>: <span style="color:#d14">&#34;/etc/kubeasz&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Destination&#34;</span>: <span style="color:#d14">&#34;/etc/kubeasz&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Mode&#34;</span>: <span style="color:#d14">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;RW&#34;</span>: true,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Propagation&#34;</span>: <span style="color:#d14">&#34;rprivate&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Type&#34;</span>: <span style="color:#d14">&#34;bind&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Source&#34;</span>: <span style="color:#d14">&#34;/root/.kube&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Destination&#34;</span>: <span style="color:#d14">&#34;/root/.kube&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Mode&#34;</span>: <span style="color:#d14">&#34;&#34;</span>,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;RW&#34;</span>: true,
</span></span><span style="display:flex;"><span>                <span style="color:#d14">&#34;Propagation&#34;</span>: <span style="color:#d14">&#34;rprivate&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#000;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#000;font-weight:bold">]</span>,
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改<code>/etc/kubeasz/clusters/k8s-test/hosts</code>文件。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>egrep -v <span style="color:#d14">&#34;^</span>$<span style="color:#d14">|^#&#34;</span> /etc/kubeasz/clusters/k8s-test/hosts
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 按照规划，etcd和master共用节点</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>etcd<span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>192.168.1.56
</span></span><span style="display:flex;"><span>192.168.1.45
</span></span><span style="display:flex;"><span>192.168.1.117
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>kube_master<span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>192.168.1.56
</span></span><span style="display:flex;"><span>192.168.1.45
</span></span><span style="display:flex;"><span>192.168.1.117
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 配置node节点</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>kube_node<span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>192.168.1.72
</span></span><span style="display:flex;"><span>192.168.1.7
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>harbor<span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>ex_lb<span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>chrony<span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>all:vars<span style="color:#000;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">SECURE_PORT</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;6443&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">CONTAINER_RUNTIME</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;containerd&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 使用flannel。优点是简单，轻量，易维护。</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 镜像最好提前通过ezdown -X准备好。</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">CLUSTER_NETWORK</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;flannel&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">PROXY_MODE</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;ipvs&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># service网段</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">SERVICE_CIDR</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;10.68.0.0/16&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># pod网段</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">CLUSTER_CIDR</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;172.20.0.0/16&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">NODE_PORT_RANGE</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;30000-32767&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">CLUSTER_DNS_DOMAIN</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;cluster.local&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">bin_dir</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/opt/kube/bin&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">base_dir</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/etc/kubeasz&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">cluster_dir</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;{{ base_dir }}/clusters/k8s-test&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">ca_dir</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#34;/etc/kubernetes/ssl&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#008080">k8s_nodename</span><span style="color:#000;font-weight:bold">=</span><span style="color:#d14">&#39;&#39;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>修改<code>/etc/kubeasz/clusters/k8s-test/config.yml</code>文件。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">95
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>root@hw-sg-k8s-master-test-0001 ~<span style="color:#000;font-weight:bold">]</span><span style="color:#998;font-style:italic"># egrep -v &#34;^$|^#&#34; /etc/kubeasz/clusters/k8s-test/config.yml</span>
</span></span><span style="display:flex;"><span>INSTALL_SOURCE: <span style="color:#d14">&#34;online&#34;</span>
</span></span><span style="display:flex;"><span>OS_HARDEN: <span style="color:#0086b3">false</span>
</span></span><span style="display:flex;"><span>CA_EXPIRY: <span style="color:#d14">&#34;876000h&#34;</span>
</span></span><span style="display:flex;"><span>CERT_EXPIRY: <span style="color:#d14">&#34;438000h&#34;</span>
</span></span><span style="display:flex;"><span>CHANGE_CA: <span style="color:#0086b3">false</span>
</span></span><span style="display:flex;"><span>CLUSTER_NAME: <span style="color:#d14">&#34;cluster1&#34;</span>
</span></span><span style="display:flex;"><span>CONTEXT_NAME: <span style="color:#d14">&#34;context-{{ CLUSTER_NAME }}&#34;</span>
</span></span><span style="display:flex;"><span>K8S_VER: <span style="color:#d14">&#34;1.24.2&#34;</span>
</span></span><span style="display:flex;"><span>K8S_NODENAME: <span style="color:#d14">&#34;{%- if k8s_nodename != &#39;&#39; -%} \
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    {{ k8s_nodename|replace(&#39;_&#39;, &#39;-&#39;)|lower }} \
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               {%- else -%} \
</span></span></span><span style="display:flex;"><span><span style="color:#d14">                    {{ inventory_hostname }} \
</span></span></span><span style="display:flex;"><span><span style="color:#d14">               {%- endif -%}&#34;</span>
</span></span><span style="display:flex;"><span>ETCD_DATA_DIR: <span style="color:#d14">&#34;/var/lib/etcd&#34;</span>
</span></span><span style="display:flex;"><span>ETCD_WAL_DIR: <span style="color:#d14">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>ENABLE_MIRROR_REGISTRY: <span style="color:#0086b3">false</span>
</span></span><span style="display:flex;"><span>INSECURE_REG:
</span></span><span style="display:flex;"><span>  - <span style="color:#d14">&#34;http://easzlab.io.local:5000&#34;</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#d14">&#34;https://{{ HARBOR_REGISTRY }}&#34;</span>
</span></span><span style="display:flex;"><span>SANDBOX_IMAGE: <span style="color:#d14">&#34;easzlab.io.local:5000/easzlab/pause:3.9&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># /var/lib将会占用较大空间，可将数据盘挂载至此目录。</span>
</span></span><span style="display:flex;"><span>CONTAINERD_STORAGE_DIR: <span style="color:#d14">&#34;/var/lib/containerd&#34;</span>
</span></span><span style="display:flex;"><span>DOCKER_STORAGE_DIR: <span style="color:#d14">&#34;/var/lib/docker&#34;</span>
</span></span><span style="display:flex;"><span>DOCKER_ENABLE_REMOTE_API: <span style="color:#0086b3">false</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># k8s 集群 master 节点证书配置，可以添加多个ip和域名（比如增加公网ip和域名）</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 全部master地址，域名，lb地址，公网地址，127.0.0.1补充完整，千万不要漏！</span>
</span></span><span style="display:flex;"><span>MASTER_CERT_HOSTS:
</span></span><span style="display:flex;"><span>  - <span style="color:#d14">&#34;192.168.1.56&#34;</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#d14">&#34;192.168.1.45&#34;</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#d14">&#34;192.168.1.117&#34;</span>
</span></span><span style="display:flex;"><span>  - <span style="color:#d14">&#34;127.0.0.1&#34;</span>
</span></span><span style="display:flex;"><span>NODE_CIDR_LEN: <span style="color:#099">24</span>
</span></span><span style="display:flex;"><span>KUBELET_ROOT_DIR: <span style="color:#d14">&#34;/var/lib/kubelet&#34;</span>
</span></span><span style="display:flex;"><span>MAX_PODS: <span style="color:#099">110</span>
</span></span><span style="display:flex;"><span>KUBE_RESERVED_ENABLED: <span style="color:#d14">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>SYS_RESERVED_ENABLED: <span style="color:#d14">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>FLANNEL_BACKEND: <span style="color:#d14">&#34;vxlan&#34;</span>
</span></span><span style="display:flex;"><span>DIRECT_ROUTING: <span style="color:#0086b3">false</span>
</span></span><span style="display:flex;"><span>flannel_ver: <span style="color:#d14">&#34;v0.22.2&#34;</span>
</span></span><span style="display:flex;"><span>CALICO_IPV4POOL_IPIP: <span style="color:#d14">&#34;Always&#34;</span>
</span></span><span style="display:flex;"><span>IP_AUTODETECTION_METHOD: <span style="color:#d14">&#34;can-reach={{ groups[&#39;kube_master&#39;][0] }}&#34;</span>
</span></span><span style="display:flex;"><span>CALICO_NETWORKING_BACKEND: <span style="color:#d14">&#34;bird&#34;</span>
</span></span><span style="display:flex;"><span>CALICO_RR_ENABLED: <span style="color:#0086b3">false</span>
</span></span><span style="display:flex;"><span>CALICO_RR_NODES: <span style="color:#000;font-weight:bold">[]</span>
</span></span><span style="display:flex;"><span>calico_ver: <span style="color:#d14">&#34;v3.24.6&#34;</span>
</span></span><span style="display:flex;"><span>calico_ver_main: <span style="color:#d14">&#34;{{ calico_ver.split(&#39;.&#39;)[0] }}.{{ calico_ver.split(&#39;.&#39;)[1] }}&#34;</span>
</span></span><span style="display:flex;"><span>cilium_ver: <span style="color:#d14">&#34;1.13.6&#34;</span>
</span></span><span style="display:flex;"><span>cilium_connectivity_check: <span style="color:#0086b3">true</span>
</span></span><span style="display:flex;"><span>cilium_hubble_enabled: <span style="color:#0086b3">false</span>
</span></span><span style="display:flex;"><span>cilium_hubble_ui_enabled: <span style="color:#0086b3">false</span>
</span></span><span style="display:flex;"><span>kube_ovn_ver: <span style="color:#d14">&#34;v1.11.5&#34;</span>
</span></span><span style="display:flex;"><span>OVERLAY_TYPE: <span style="color:#d14">&#34;full&#34;</span>
</span></span><span style="display:flex;"><span>FIREWALL_ENABLE: <span style="color:#0086b3">true</span>
</span></span><span style="display:flex;"><span>kube_router_ver: <span style="color:#d14">&#34;v1.5.4&#34;</span>
</span></span><span style="display:flex;"><span>dns_install: <span style="color:#d14">&#34;yes&#34;</span>
</span></span><span style="display:flex;"><span>corednsVer: <span style="color:#d14">&#34;1.11.1&#34;</span>
</span></span><span style="display:flex;"><span>ENABLE_LOCAL_DNS_CACHE: <span style="color:#0086b3">true</span>
</span></span><span style="display:flex;"><span>dnsNodeCacheVer: <span style="color:#d14">&#34;1.22.23&#34;</span>
</span></span><span style="display:flex;"><span>LOCAL_DNS_CACHE: <span style="color:#d14">&#34;169.254.20.10&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 不需要metricsserver，可以先不安装。</span>
</span></span><span style="display:flex;"><span>metricsserver_install: <span style="color:#d14">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>metricsVer: <span style="color:#d14">&#34;v0.6.4&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#998;font-style:italic"># 不需要dashboard，可以先不安装。</span>
</span></span><span style="display:flex;"><span>dashboard_install: <span style="color:#d14">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>dashboardVer: <span style="color:#d14">&#34;v2.7.0&#34;</span>
</span></span><span style="display:flex;"><span>dashboardMetricsScraperVer: <span style="color:#d14">&#34;v1.0.8&#34;</span>
</span></span><span style="display:flex;"><span>prom_install: <span style="color:#d14">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>prom_namespace: <span style="color:#d14">&#34;monitor&#34;</span>
</span></span><span style="display:flex;"><span>prom_chart_ver: <span style="color:#d14">&#34;45.23.0&#34;</span>
</span></span><span style="display:flex;"><span>kubeapps_install: <span style="color:#d14">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>kubeapps_install_namespace: <span style="color:#d14">&#34;kubeapps&#34;</span>
</span></span><span style="display:flex;"><span>kubeapps_working_namespace: <span style="color:#d14">&#34;default&#34;</span>
</span></span><span style="display:flex;"><span>kubeapps_storage_class: <span style="color:#d14">&#34;local-path&#34;</span>
</span></span><span style="display:flex;"><span>kubeapps_chart_ver: <span style="color:#d14">&#34;12.4.3&#34;</span>
</span></span><span style="display:flex;"><span>local_path_provisioner_install: <span style="color:#d14">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>local_path_provisioner_ver: <span style="color:#d14">&#34;v0.0.24&#34;</span>
</span></span><span style="display:flex;"><span>local_path_provisioner_dir: <span style="color:#d14">&#34;/opt/local-path-provisioner&#34;</span>
</span></span><span style="display:flex;"><span>nfs_provisioner_install: <span style="color:#d14">&#34;no&#34;</span>
</span></span><span style="display:flex;"><span>nfs_provisioner_namespace: <span style="color:#d14">&#34;kube-system&#34;</span>
</span></span><span style="display:flex;"><span>nfs_provisioner_ver: <span style="color:#d14">&#34;v4.0.2&#34;</span>
</span></span><span style="display:flex;"><span>nfs_storage_class: <span style="color:#d14">&#34;managed-nfs-storage&#34;</span>
</span></span><span style="display:flex;"><span>nfs_server: <span style="color:#d14">&#34;192.168.1.10&#34;</span>
</span></span><span style="display:flex;"><span>nfs_path: <span style="color:#d14">&#34;/data/nfs&#34;</span>
</span></span><span style="display:flex;"><span>network_check_enabled: <span style="color:#0086b3">false</span>
</span></span><span style="display:flex;"><span>network_check_schedule: <span style="color:#d14">&#34;*/5 * * * *&#34;</span>
</span></span><span style="display:flex;"><span>HARBOR_VER: <span style="color:#d14">&#34;v2.6.4&#34;</span>
</span></span><span style="display:flex;"><span>HARBOR_DOMAIN: <span style="color:#d14">&#34;harbor.easzlab.io.local&#34;</span>
</span></span><span style="display:flex;"><span>HARBOR_PATH: /var/data
</span></span><span style="display:flex;"><span>HARBOR_TLS_PORT: <span style="color:#099">8443</span>
</span></span><span style="display:flex;"><span>HARBOR_REGISTRY: <span style="color:#d14">&#34;{{ HARBOR_DOMAIN }}:{{ HARBOR_TLS_PORT }}&#34;</span>
</span></span><span style="display:flex;"><span>HARBOR_SELF_SIGNED_CERT: <span style="color:#0086b3">true</span>
</span></span><span style="display:flex;"><span>HARBOR_WITH_NOTARY: <span style="color:#0086b3">false</span>
</span></span><span style="display:flex;"><span>HARBOR_WITH_TRIVY: <span style="color:#0086b3">false</span>
</span></span><span style="display:flex;"><span>HARBOR_WITH_CHARTMUSEUM: <span style="color:#0086b3">true</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>根据实际情况决定是否需要新加一块数据盘挂载到<code>/var/lib</code>目录。</p>
<p>修改内核配置文件<code>/etc/kubeasz/roles/prepare/templates/95-k8s-sysctl.conf.j2</code>。</p>
<p>在第一行添加如下内容，否则可能会出现<code>pod</code>一直处于<code>Terminating</code>状态，无法回收。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>fs.may_detach_mounts <span style="color:#000;font-weight:bold">=</span> <span style="color:#099">1</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="安装集群">安装集群</h2>
<p>一键安装集群</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker <span style="color:#0086b3">exec</span> -it kubeasz ezctl setup k8s-test all
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="验证集群">验证集群</h2>
<p>重新登录后，可以执行<code>kubectl</code>命令。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">[</span>root@hw-sg-k8s-master-test-0001 ~<span style="color:#000;font-weight:bold">]</span><span style="color:#998;font-style:italic"># kubectl cluster-info</span>
</span></span><span style="display:flex;"><span>Kubernetes control plane is running at https://192.168.1.56:6443
</span></span><span style="display:flex;"><span>CoreDNS is running at https://192.168.1.56:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span></span><span style="display:flex;"><span>KubeDNSUpstream is running at https://192.168.1.56:6443/api/v1/namespaces/kube-system/services/kube-dns-upstream:dns/proxy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>To further debug and diagnose cluster problems, use <span style="color:#d14">&#39;kubectl cluster-info dump&#39;</span>.
</span></span></code></pre></td></tr></table>
</div>
</div><p>查看<code>pod</code>状态。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>kubectl get pod -n kube-system
</span></span><span style="display:flex;"><span>NAME                       READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>coredns-7bc88ddb8b-n4f5s   1/1     Running   <span style="color:#099">0</span>          39s
</span></span><span style="display:flex;"><span>kube-flannel-ds-czz8g      1/1     Running   <span style="color:#099">0</span>          52s
</span></span><span style="display:flex;"><span>kube-flannel-ds-j6b2c      1/1     Running   <span style="color:#099">0</span>          52s
</span></span><span style="display:flex;"><span>kube-flannel-ds-jc4m4      1/1     Running   <span style="color:#099">0</span>          52s
</span></span><span style="display:flex;"><span>kube-flannel-ds-kvxb5      1/1     Running   <span style="color:#099">0</span>          52s
</span></span><span style="display:flex;"><span>kube-flannel-ds-phx4v      1/1     Running   <span style="color:#099">0</span>          52s
</span></span><span style="display:flex;"><span>node-local-dns-47vjj       1/1     Running   <span style="color:#099">0</span>          38s
</span></span><span style="display:flex;"><span>node-local-dns-g2dcf       1/1     Running   <span style="color:#099">0</span>          38s
</span></span><span style="display:flex;"><span>node-local-dns-hlxpt       1/1     Running   <span style="color:#099">0</span>          38s
</span></span><span style="display:flex;"><span>node-local-dns-wlvgb       1/1     Running   <span style="color:#099">0</span>          38s
</span></span><span style="display:flex;"><span>node-local-dns-xmzc9       1/1     Running   <span style="color:#099">0</span>          38s
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="添加节点">添加节点</h2>
<p>将新开的<code>192.168.1.93</code>服务器加入到集群中。需要注意容器目录<code>/var/lib/</code>空间是否充足。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>ssh-copy-id 192.168.1.93
</span></span><span style="display:flex;"><span>docker <span style="color:#0086b3">exec</span> -it kubeasz ezctl add-node k8s-test 192.168.1.93
</span></span></code></pre></td></tr></table>
</div>
</div><p>验证。</p>
<pre tabindex="0"><code class="language-sehll" data-lang="sehll">kubectl get node

NAME            STATUS                     ROLES    AGE   VERSION
192.168.1.117   Ready,SchedulingDisabled   master   23m   v1.28.1
192.168.1.45    Ready,SchedulingDisabled   master   23m   v1.28.1
192.168.1.56    Ready,SchedulingDisabled   master   23m   v1.28.1
192.168.1.7     Ready                      node     22m   v1.28.1
192.168.1.72    Ready                      node     22m   v1.28.1
192.168.1.93    Ready                      node     30s   v1.28.1
</code></pre><h2 id="删除节点">删除节点</h2>
<p>将<code>192.168.1.93</code>从集群中删除。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">9
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>docker <span style="color:#0086b3">exec</span> -it kubeasz ezctl del-node k8s-test 192.168.1.93
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kubectl get nodes
</span></span><span style="display:flex;"><span>NAME            STATUS                     ROLES    AGE   VERSION
</span></span><span style="display:flex;"><span>192.168.1.117   Ready,SchedulingDisabled   master   26m   v1.28.1
</span></span><span style="display:flex;"><span>192.168.1.45    Ready,SchedulingDisabled   master   26m   v1.28.1
</span></span><span style="display:flex;"><span>192.168.1.56    Ready,SchedulingDisabled   master   26m   v1.28.1
</span></span><span style="display:flex;"><span>192.168.1.7     Ready                      node     25m   v1.28.1
</span></span><span style="display:flex;"><span>192.168.1.72    Ready                      node     25m   v1.28.1
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<center><img src="https://images.snoopyops.top/wechat-snoopy.jpg" alt="image-20231028232834657" style="zoom:50%;" /></center>

    </div>
    
    

    
</div>

            </div>
            <div id="footer"><div class="container-footer">
    
    

    <div class="beian">
        
        <a target="_blank" href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=">
            

        </a>

        <a href="" target="_blank">
            
            <span class="some">icp...<span>
            
        </a>
    </div>

    <div class="info">
        <a href="https://github.com/loveminimal/hugo-theme-virgo">Copyright</a> ©  - <span id="info-date"></span>
    </div>

</div></div>
        </div>
        <div class="cool-after" style="background-color: rgba(255, 255, 255, 0.81);"></div>
    </body>
</html>
<link href="https://qiniu.techgrow.cn/readmore/dist/readmore.css" type="text/css" rel="stylesheet">
<script src="https://qiniu.techgrow.cn/readmore/dist/readmore.js" type="text/javascript"></script>
<script>
    var regex = /(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i
    var isMobile = navigator.userAgent.match(regex);
    if (!isMobile) {
        try {
            var plugin = new ReadmorePlugin();
            plugin.init({
                id: "readmore-container",
                blogId: "25525-2853989927488-092",
                name: "史努比会点运维",
                keyword: "验证码",
                qrcode: "https://images.snoopyops.top/wechat/wechat_snoopyops.jpg",
                type: "hugo",
                height: "auto",
                expires: "7",
                interval: "60",
                random: "1"
            })
        } catch (e) {
            console.warn("readmore plugin occurred error: " + e.name + " | " + e.message);
        }
    }
</script>
